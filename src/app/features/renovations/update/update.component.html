<div *ngIf="isLoadingResults" fxLayout="column" fxLayoutAlign="center center" class="user-spinner">   
  <mat-spinner color="primary"></mat-spinner>
</div>

<mat-card >
    <mat-horizontal-stepper linear #stepper>
        <mat-step [stepControl]="formBudget">
          <form [formGroup]="formBudget">
            <ng-template matStepLabel>BUDGET</ng-template>
            <div fxLayout="row" fxLayoutAlign="start" fxLayout.lt-md="row wrap">
                <mat-form-field appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="50">
                    <mat-label>Appellation de la renovation a effectuer</mat-label>
                    <input matInput #input maxlength="50" placeholder="Ex. Nougat" formControlName="nomRenovation" required>
                </mat-form-field>
            </div>
            <div fxLayout="row" fxLayoutAlign="center" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px">
                
                <mat-form-field appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="50">
                    <mat-label>Avez-vous obtenu vos financements ?</mat-label>
                    <input matInput #input maxlength="100" placeholder="Ex. Nougat" formControlName="avoirFinancement" required>
                </mat-form-field>
                <mat-form-field appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="50">
                    <mat-label>Quel est votre budget travaux ?</mat-label>
                    <mat-select disableRipple formControlName="budgetTravaux" required>
                        <mat-option >--SELECT--</mat-option>
                        <mat-option value="moins de 5000 ">moins de 5000 Euros</mat-option>
                        <mat-option value="Entre 5000 et 20.000 Euros">Entre 5000 et 20.000 Euros</mat-option>
                        <mat-option value="Entre 20.000 et 50.000 Euros">Entre 20.000 et 50.000 Euros</mat-option>
                        <mat-option value="Entre 50.000 et 100.000 Euros">Entre 50.000 et 100.000 Euros</mat-option>
                        <mat-option value="Entre 100.000 et 150.000 Euros">Entre 100.000 et 150.000 Euros</mat-option>
                        <mat-option value="Entre 150.000 et 250.000 Euros">Entre 150.000 et 250.000 Euros</mat-option>
                        <mat-option value="plus de 250.000 Euros">plus de 250.000 Euros</mat-option>
                      </mat-select>
                </mat-form-field>
            </div>
    
            <div fxLayout="row" fxLayoutAlign="start" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px">
                <mat-form-field appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="50">
                    <mat-label>Faites-vous appel à un financement public ?</mat-label>
                    <mat-select disableRipple formControlName="faisAppelFianacePublic" required>
                        <mat-option >--SELECT--</mat-option>
                        <mat-option value="true">Oui</mat-option>
                        <mat-option value="false">Non</mat-option>
                      </mat-select>
                  </mat-form-field>
                <mat-form-field appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="50">
                    <mat-label>Avez-vous effectuer un plan de financement ?</mat-label>
                    <mat-select disableRipple formControlName="aeffectuerPlanFinance" required>
                      <mat-option >--SELECT--</mat-option>
                      <mat-option value="true">Oui</mat-option>
                      <mat-option value="false">Non</mat-option>
                    </mat-select>
                  </mat-form-field>
            </div>
            <div fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" align="end">
              <button mat-raised-button color="warn" routerLink="/renovation" matStepperNext>Annuler</button>
              <button mat-raised-button color="primary" matStepperNext>Suivant</button>
            </div>
          </form>
        </mat-step>
    
    
    
    
    
    
    
    
    
    
    
        <mat-step [stepControl]="formRenovation" errorMessage="Address is required.">
          <form [formGroup]="formRenovation">
            <ng-template matStepLabel>LE PROJET DE RENOVATION</ng-template>
            <div fxLayout="row" fxLayoutAlign="start" fxLayout.lt-md="row wrap">
                <mat-form-field appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="50">
                    <mat-label>Type de bien ?</mat-label>
                    <mat-select disableRipple formControlName="typeBien" required>
                        <mat-option >--SELECT--</mat-option>
                        <mat-option value="APPARTEMENT ">Appartement</mat-option>
                        <mat-option value="Maison">Maison</mat-option>
                        <mat-option value="Immeuble">Immeuble</mat-option>
                        <mat-option value="Commerce">Commerce</mat-option>
                        <mat-option value="Autre">Autre</mat-option>
                      </mat-select>
                </mat-form-field>
            </div>
            <div fxLayout="row" fxLayoutAlign="center" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px">
                <mat-form-field appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="50">
                    <mat-label>Surface au sol de votre bien ?</mat-label>
                    <input matInput type="number" formControlName="surfaceSol">
                </mat-form-field>
                <mat-form-field appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="50">
                    <mat-label>Nombre de pièce</mat-label>
                    <mat-select disableRipple formControlName="nombrePiece"  required>
                        <mat-option >--SELECT--</mat-option>
                        <mat-option value="2">2</mat-option>
                        <mat-option value="3">3</mat-option>
                        <mat-option value="4">4</mat-option>
                        <mat-option value="5">5</mat-option>
                        <mat-option value="6">6</mat-option>
                        <mat-option value="7">7</mat-option>
                        <mat-option value="plus de 7">+ de 7 pièces</mat-option>
                      </mat-select>
                </mat-form-field>
            </div>
    
            <div fxLayout="row" fxLayoutAlign="center" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px">
                <mat-form-field appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="50">
                    <mat-label>Date de démarrage souhaité</mat-label>
                    <input matInput formControlName="dateDemarrage" [matDatepicker]="dp3" readonly>
                    <mat-datepicker-toggle matSuffix [for]="dp3"></mat-datepicker-toggle>
                    <mat-datepicker #dp3 ></mat-datepicker>
                </mat-form-field>
                <mat-form-field appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="50">
                    <mat-label>Niveau de finition souhaité</mat-label>
                    <mat-select disableRipple formControlName="niveauFinition"  required>
                        <mat-option >--SELECT--</mat-option>
                        <mat-option value="Standing">Standing</mat-option>
                        <mat-option value="Classique">Classique</mat-option>
                        <mat-option value="Rapport Qualité/Prix">Rapport Qualité/Prix</mat-option>
                      </mat-select>
                </mat-form-field>
            </div>
            <div fxLayout="row" fxLayoutAlign="center" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px">
                <mat-form-field appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="50">
                    <mat-label>Souhaitez-vous effectuer une rénovation RT-2012, RT 2020, RGE</mat-label>
                    <mat-select disableRipple formControlName="typeRenovation" required>
                        <mat-option >--SELECT--</mat-option>
                        <mat-option value="RT-2012">RT-2012</mat-option>
                        <mat-option value="RT 2020">RT 2020</mat-option>
                        <mat-option value="RGE">RGE</mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-form-field appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="50">
                    <mat-label>Type de gamme des appareillages</mat-label>
                    <input matInput formControlName="gammeAppareillages">
                </mat-form-field>
            </div>
    
            <div fxLayout="row" fxLayoutAlign="start" fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px">
                <mat-form-field appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="50">
                    <mat-label>Modification prévue des pièces (création, agrandissement, etc.?</mat-label>
                    <input matInput formControlName="modificationPrevu">
                </mat-form-field>
                <mat-form-field appearance="outline" [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="50" [fxFlex.xl]="50">
                    <mat-label>Adresse du chantier</mat-label>
                    <input matInput formControlName="adressChantier">
                </mat-form-field>
            </div>
            <div fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" align="end">
              <button mat-raised-button color="warn" routerLink="/renovation" matStepperNext>Annuler</button>
              <button mat-raised-button  matStepperPrevious>Retour</button>
              <button mat-raised-button color="primary" matStepperNext>Suivant</button>
            </div>
          </form>
        </mat-step> 
    
    
    
    
    
    
    
    
    
        <mat-step>
            <form [formGroup]="formulaire">
                <div fxLayout="column" class="flex-p">
                    <ng-template matStepLabel>JUSTIFICATIFS</ng-template>
                    <div fxLayout="row" fxLayoutAlign="start center">
    
                        <button type="button" mat-flat-button color="primary" (click)="addNewPieceIdentiteInfo()" [fxFlex.xs]="100" [fxFlexOffset.xs]="0" [fxFlex.sm]="70" [fxFlexOffset.sm]="10" [fxFlex.md]="50" [fxFlexOffset.md]="10" [fxFlex.lg]="25" [fxFlexOffset.md]="10" [fxFlex.xl]="30"
                            [fxFlexOffset]="10">
                          <mat-icon class="icon-sm">add</mat-icon> Ajouter une nouvelle Justificatif
                      </button>
    
                    </div>
    
                    <ng-container *ngIf="getFormPieceComplementaire.controls.length>0">
                        <ng-template ngFor let-pieceIdentite [ngForOf]="getFormPieceComplementaire.controls" let-i="index">
    
                            <div *ngIf="pieceIdentite.get('valide').value==null || !pieceIdentite.get('valide').value" class="card-container-form-element y-1" fxLayout="row" fxLayoutAlign="start">
                                <mat-card [fxFlex.xs]="100" [fxFlex.sm]="100" [fxFlex.md]="100" [fxFlex.lg]="100" [fxFlex.xl]="100">
                                    <button mat-icon-button (click)="supprimerFile(i)" matSuffix color="warn" class="delete-icons" type="button">
                                      <mat-icon>remove_circle</mat-icon> 
                                  </button>
    
                                    <app-uploard-file [formGroup]="pieceIdentite" [contribuableType]="'AGENT'" [touched]="pieceIdentite.touched"></app-uploard-file>
    
                                </mat-card>
                            </div>
                        </ng-template>
                    </ng-container>
                </div>
                <div fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" align="end">
                  <button mat-raised-button color="warn" routerLink="/renovation" matStepperNext>Annuler</button>
                  <button mat-raised-button  matStepperPrevious>Retour</button>
                  <button mat-raised-button color="primary" matStepperNext>Suivant</button>
                </div>
            </form>
          </mat-step>
    
    
    
    
    
        <mat-step>
          <ng-template matStepLabel>FINISH</ng-template>
          <p>Merci de valider les information inserer</p>
          <div fxLayout.lt-md="row wrap" fxLayoutGap.gt-sm="20px" align="end">
            <button mat-raised-button color="warn" routerLink="/renovation" matStepperNext>Annuler</button>
            <button mat-raised-button color="warn" (click)="stepper.reset()" matStepperPrevious>Effacer</button>
            <button mat-raised-button  matStepperPrevious>Retour</button>
            <button mat-raised-button color="primary"(click)="onSubmit()">Confirmer</button>
          </div>
        </mat-step>
      </mat-horizontal-stepper>
</mat-card>


